syntax = "v1"

info (
	title:   "user"
	desc:    ""
	author:  "LeeSeika"
	email:   "LeeSeika@outlook.com"
	version: "1.0"
)

// WxLogin
type WxLoginRequest {
	Code     string `json:"code"`
	NickName string `json:"nickname"`
}

type WxLoginResponse {
	Token        string   `json:"token"`
	RefreshToken string   `json:"refresh_token"`
	UserInfo     UserInfo `json:"user_info"`
}

type UserInfo {
	WxUid        string `json:"wx_uid"`
	Avatar       string `json:"avatar"`
	School       string `json:"school"`
	Grade        int64  `json:"grade"`
	Introduction string `json:"introduction"`
	PostCount    int64  `json:"post_count"`
	Username     string `json:"username"`
}

// RefreshToken
type RefreshTokenReqeust {}

type RefreshTokenResponse {
	Token        string `json:"token"`
	RefreshToken string `json:"refresh_token"`
}

// SetUserInfo
type SetUserInfoRequest {
	ID           string `path:"wxUid"`
	School       string `json:"school"`
	Grade        int64  `json:"grade"`
	Introduction string `json:"introduction"`
}

type SetUserInfoResponse {
	Avatar       string `json:"avatar"`
	School       string `json:"school"`
	Grade        int64  `json:"grade"`
	Introduction string `json:"introduction"`
	PostCount    int64  `json:"post_count"`
}

// GetUserInfo
type GetUserInfoRequest {
	ID string `path:"wxUid"`
}

type GetUserInfoResponse {
	Avatar       string `json:"avatar"`
	School       string `json:"school"`
	Grade        int64  `json:"grade"`
	Introduction string `json:"introduction"`
	PostCount    int64  `json:"post_count"`
}

@server (
	prefix: /api/v1
)
service User {
	@handler WxLogin
	post /users/wxlogin (WxLoginRequest) returns (WxLoginResponse)

	@handler GetUserInfo
	get /users/:wxUid (GetUserInfoRequest) returns (GetUserInfoResponse)
}

@server (
	jwt:    Auth
	prefix: /api/v1
)
service User {
	@handler RefreshToken
	get /users/token (RefreshTokenReqeust) returns (RefreshTokenResponse)

	@handler SetUserInfo
	put /users/wxUid (SetUserInfoRequest) returns (SetUserInfoResponse)
}

